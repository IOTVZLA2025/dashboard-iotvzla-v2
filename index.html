
<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>MONITOREO VARIABLES MILLARES</title>
<link rel="icon" href="logo-millares.png" type="image/png">
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0b1622" />

<style>
  :root{
    --bg:#071427;
    --card:#0b1220;
    --accent:#00bcd4;
    --muted:#9fb3c8;
    --green:#00c853;
    --yellow:#ffca28;
    --orange:#ff9800;
    --red:#ff1744;
    --blue:#29b6f6;
  }

  body{
    margin:0;
    font-family:Arial,Helvetica,sans-serif;
    background:var(--bg);
    color:white;
  }

  /* HEADER */
  .header{
    padding:14px;
    background:var(--card);
    border-bottom:1px solid rgba(255,255,255,0.05);
  }
  .header-content{
    display:flex;
    gap:12px;
    align-items:center;
    max-width:900px;
    margin:0 auto;
  }
  .header-logo{
    width:42px;
    height:42px;
    border-radius:8px;
    background:rgba(255,255,255,0.05);
    padding:4px;
  }
  .header-text h1{
    font-size:18px;
    margin:0;
  }
  .header-company{color:var(--accent);font-size:14px;font-weight:600;}
  .header-subtitle{font-size:12px;color:var(--muted)}

  /* LAYOUT */
  .container{max-width:900px;margin:20px auto;padding:10px;}

  /* TERMOMETRO HORIZONTAL */
  .thermo-card{
    background:var(--card);
    padding:25px;
    border-radius:14px;
    border:1px solid rgba(255,255,255,0.03);
    box-shadow:0 10px 30px rgba(0,0,0,0.4);
    margin-bottom:20px;
  }

  .thermo-wrap{
    width:100%;
    display:flex;
    flex-direction:column;
    align-items:center;
    gap:25px;
  }

  /* TUBO */
  .thermo-bar{
    position:relative;
    width:100%;
    height:40px;
    background:#0a1525;
    border-radius:20px;
    border:4px solid var(--yellow);
    overflow:hidden;
  }

  /* MERCURIO */
  .thermo-mercury{
    position:absolute;
    left:0;
    top:0;
    height:100%;
    width:20%;
    background:linear-gradient(90deg,var(--green),var(--yellow),var(--orange),var(--red));
    transition: width 1s ease;
  }

  /* NUMEROS SIN "°C" */
  .thermo-scale{
    width:100%;
    display:flex;
    justify-content:space-between;
    font-size:14px;
    font-weight:600;
    color:white;
    margin-top:5px;
  }

  /* TEMPERATURA DIGITAL */
  .temp-digital{
    font-size:56px;
    font-weight:800;
    color:var(--yellow);
    text-shadow:0 5px 20px rgba(255,255,0,0.3);
    margin:10px 0;
  }

  /* CONTENEDOR PARA LOS DOS CUADROS DEBAJO DE LA TEMPERATURA */
  .status-container{
    display:flex;
    gap:20px;
    width:100%;
    margin-top:10px;
  }
  @media(max-width:768px){
    .status-container{flex-direction:column;}
  }

  /* CARDS PEQUEÑOS DEBAJO DE LA TEMPERATURA */
  .status-card{
    flex:1;
    background:rgba(255,255,255,0.03);
    border-radius:12px;
    padding:18px;
    text-align:center;
    border:1px solid rgba(255,255,255,0.05);
  }
  .status-title{font-size:15px;font-weight:700;margin-bottom:10px}
  .status-text{font-size:13px;color:var(--muted);margin-bottom:12px}
  .led{
    width:65px;
    height:65px;
    border-radius:14px;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:24px;
    font-weight:800;
    margin:0 auto;
  }
  .led-green{background:var(--green);color:#021}
  .led-yellow{background:var(--yellow);color:#2b1a00}
  .led-red{background:var(--red);color:#250005}
  .led-off{background:rgba(255,255,255,0.05);color:var(--muted)}

  /* FOOTER COPYRIGHT */
  .footer-copy{
    text-align:center;
    font-size:14px;
    color:var(--blue);
    margin-top:25px;
    font-weight:700;
  }

</style>
</head>

<body>

<header class="header">
  <div class="header-content">
    <img src="logo-millares.png" class="header-logo">
    <div class="header-text">
      <h1>MONITOREO DE VARIABLES</h1>
      <div class="header-company">MILLARES INGENIERIA BAGB SPA IOT-CHILE</div>
      <div class="header-subtitle">Temperatura · Alarma · Reset</div>
    </div>
  </div>
</header>

<div class="container">

  <!-- TERMOMETRO HORIZONTAL COMPLETO -->
  <div class="thermo-card">
    <div class="thermo-wrap">

      <!-- Barra del termómetro -->
      <div class="thermo-bar">
        <div id="mercury" class="thermo-mercury"></div>
      </div>

      <!-- Numeración (sin °C) -->
      <div class="thermo-scale">
        <span>-15</span><span>0</span><span>10</span><span>20</span><span>30</span><span>40</span><span>50</span><span>60</span><span>70</span><span>80</span><span>90</span><span>100</span>
      </div>

      <!-- Display de temperatura (4 dígitos) -->
      <div class="temp-digital">
        <span id="tempValue">0.0</span>°C
      </div>

      <!-- CONTENEDOR PARA LOS DOS CUADROS DEBAJO DE LA TEMPERATURA -->
      <div class="status-container">
        
        <!-- ALARMA - LADO IZQUIERDO -->
        <div class="status-card">
          <div class="status-title">Estado alarma</div>
          <div id="alarmText" class="status-text">Normal</div>
          <div id="ledAlarm" class="led led-green">✓</div>
        </div>

        <!-- RESET - LADO DERECHO -->
        <div class="status-card">
          <div class="status-title">Reset</div>
          <div id="resetText" class="status-text">No activo</div>
          <div id="ledReset" class="led led-off">-</div>
        </div>

      </div>

    </div>
  </div>

  <!-- COPYRIGHT PROFESIONAL ABAJO -->
  <div class="footer-copy">
    &copy; MILLARES INGENIERIA SPA CHILE
  </div>

</div>

<script>
const CONFIG = {
  channelId: "3194050",
  apiKey: "4L6L63LNFO0YG4BB",
  alarm: 50,
  reset: 60
};

async function getTemp(){
  try{
    const url=`https://api.thingspeak.com/channels/${CONFIG.channelId}/fields/1/last.json?api_key=${CONFIG.apiKey}`;
    const r=await fetch(url);
    const j=await r.json();
    return parseFloat(j.field1);
  }catch(e){return 0}
}

function updateThermo(t){
  const min=-15, max=100;
  const pct=Math.max(0,Math.min(1,(t-min)/(max-min)));
  document.getElementById("mercury").style.width=(pct*100)+"%";
  document.getElementById("tempValue").textContent=t.toFixed(1);
}

function updateStatus(t){
  const alarmLed=document.getElementById("ledAlarm");
  const alarmText=document.getElementById("alarmText");
  const resetLed=document.getElementById("ledReset");
  const resetText=document.getElementById("resetText");

  if(t>CONFIG.alarm){
    alarmLed.className="led led-red";
    alarmLed.textContent="!";
    alarmText.textContent="ALARMA ACTIVADA";
  }else if(t>30){
    alarmLed.className="led led-yellow";
    alarmLed.textContent="⚠";
    alarmText.textContent="ADVERTENCIA";
  }else{
    alarmLed.className="led led-green";
    alarmLed.textContent="✓";
    alarmText.textContent="Normal";
  }

  if(t>CONFIG.reset){
    resetLed.className="led led-red";
    resetLed.textContent="!";
    resetText.textContent="RESET RECOMENDADO";
  }else{
    resetLed.className="led led-off";
    resetLed.textContent="-";
    resetText.textContent="No activo";
  }
}

async function loop(){
  const t=await getTemp();
  updateThermo(t);
  updateStatus(t);
}

loop();
setInterval(loop,30000);
</script>

</body>
</html>
